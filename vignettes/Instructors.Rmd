---
title: "Instructors' Guide"
output: rmarkdown::html_vignette
author: "Daniel Kaplan"
vignette: >
  %\VignetteIndexEntry{Instructors' Guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include=FALSE}
library(mosaicCalc)
```

This guide is intended for instructors who plan to use the `{mosaicCalc}` package for teaching calculus or related disciplines. The main point of the guide is to make explicit the conventions used in `{mosaicCalc}`, so that they can be better emphasized to students. If you are an instructor (or student) just getting started with R, better to start with the "Calculus with R" vignette.

## Functions and tilde expressions

There are many ways to define calculus, the perspective taken in `{mosaicCalc}` and the associated [*MOSAIC Calculus* textbook](http://dtkaplan.github.io/MC2) puts *continuous functions* at the core. Consequently, the representation of mathematical functions is a central design choice for `{mosaicCalc}`.

`{mosaicCalc}` uses *two* different R-language constructs to represent mathematical functions. The simple mathematical definition $$f(x) \equiv a x + b$$ suffices to illustrate the situation. In this mathematical notation, $f$ is the name of the function, $x$ is the sole *argument* of the mathematical function, and $a$ and $b$ are *parameters*. Like so much traditional mathematics notation, the identification of $a$ and $b$ as "parameters" is implicit, not explicit, in the notation.

To see why two R-language constructs are used in `{mosaicCalc}` to represent functions, consider what would be to many people the obvious translation of $f(x) \equiv a x + b$ into R:

```{r}
f <- function(x) a*x + b  # not mosaicCalc convention
```

The above definition reads well but leaves unsettled what should be the values of `a` and `b` in the function body. In computer languages, this question is settled by "scoping rules." Expert R programmers know that `a` and `b` will be captured from the environment where the command is carried out. 

The function-building conventions of `{mosaicCalc}` were developed to avoid students needing to know about scoping or environments in R. This is managed by making *every* parameter an *argument* to the function. In standard R, this definition would do the job:

```{r}
f <- function(x, a, b) a*x + b  # every param an argument
```

Standard R also allows "default values" to be assigned to any or all of the arguments, for instance

```{r}
f <- function(x, a = 3, b = -1) a*x + b  # default values set
```

This is wordy and error prone. For example, mistakenly writing `p = -1` instead of `b = -1` results in a function that will silently draw the value of `b` from the surounding environment. In the design of `{mosaicCalc}`, we sought to avoid the wordiness and reduce the possibility for error. Although it's perfectly feasible to use the wordy construction, `{mosaicCalc}` provides a shortcut:

```{r}
# mosaicCalc convention
f <- makeFun(a*x + b ~ x)
```

The expression `a*x + b ~ x` is called a ***tilde expression***. . In conventional R terminology, such expressions involving the "tilde" character are called "formulas." Regretably, this name conflicts with mainstream uses of the word in mathematics (and even statistics). The unconventional term "tilde expression" puts front and center the role of the tilde character in the syntax.


Optionally, `makeFun()` can be used to set default values for parameters that can optionally be overridden when the function is invoked .

```{r}
# setting default values for parameters
f <- makeFun(a*x + b ~ x, a=3, b=-1)
```

Starting in version 0.6 of `{mosaicCalc}`, one-sided formulas can be used in `makeFun()`, for instance `f <- makeFun(~ a*x + b, a=3, b=77)`. We will return to the matter of one- versus two-sided formulas later.

## Bounds

Many tasks using functions require specifying a region of the function's domain. For instance, drawing the graph of a function  requires specifying a finite region. Similarly, "definite integration", for example $$\int_0^\infty \text{gaussian}(x)\,dx\ ,$$ involves the region $0 \leq x < \infty$ between the "limits of integration" or "bounds of integration." In `{mosaicCalc}`, regions are specified using the R/mosaicCalc function `bounds()`. The following illustrates simple operations on `dnorm()`, the R name for the Gaussian function. 

```{r}
slice_plot(dnorm(x) ~ x, bounds(x=-3:2))
Integrate(dnorm(x) ~ x, bounds(x=-2:2))
```

(For backwards compatibility, a synonym for `bounds()` is `domain()`. The names can be used interchangeably.)

Bounds can incorporate two or more inputs, for instance:

```r
contour_plot(cos(x)*exp(-t) ~ x & t, bounds(x=0:10, t=0:2))
```

Several things to point out about `bounds()` and its use ...

1. `bounds()` is always called as a function. It is **invalid** to use a named-argument syntax like `bounds = 0:10`.
2. `bounds()` requires that the quantity being referred to, `x` and `t` in the above example, be explicit.
3. When there is more than one quantity being bounded, all must be stated within a single call to `bounds()`.
4. The preferred syntax in `bounds()` is something like `bounds(x=0.5:3.4)`, using the colon (`:`) operator. The `:` operator when used in this context is equivalent to `c(0.5, 3.4)`.
5. Two other valid constructs in arguments to `bounds()` are `bounds(x=c(0.5, 3.4))` and `bounds(x=2.5 %pm% 1)`. The latter is helpful when you want to zoom in on a region. The `c(0.5, 3.4)` is unnecessarily verbose. (It also can lead to mistakes. Try `bounds(x=c(5:3.4)))` to see what goes amiss.)
6. In every `{mosaicCalc}` function that requires a region be specified, the call to `bounds()` must come *immediately* after the tilde expression(s). 

